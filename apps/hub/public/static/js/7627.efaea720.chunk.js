"use strict";(globalThis.webpackChunkfarahub=globalThis.webpackChunkfarahub||[]).push([[7627],{17627:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var r=n(66934),o=n(57621),l=n(39504),i=n(61889),s=n(19658),a=n(78703),c=n.n(a),g=n(2959),u=n(39230),m=n(97002),d=n(61709),h=n(7175),b=n(68870),f=n(58518),p=n(72791);const y=({roulette:e})=>{const{size:t}=e;return p.createElement("canvas",{ref:e.canvasRef,width:t,height:t})},x={size:400,maxSpeed:100,rotationDirection:"clockwise",acceleration:1,deceleration:1,initialAngle:0,determineAngle:45,showArrow:!0,style:{canvas:{bg:"#fff"},arrow:{bg:"#000",size:16},label:{font:"16px Arial",align:"right",baseline:"middle",offset:.75,defaultColor:"#000"},pie:{border:!1,borderColor:"#000",borderWidth:2,theme:[{bg:"#e0e7ff"},{bg:"#a5b4fc"},{bg:"#6366f1",color:"#fff"},{bg:"#4338ca",color:"#fff"}]}}},S=e=>(360-e)*Math.PI/180,w=(()=>{let e=null,t=0;return n=>{if(e===n)return t;const r=n.reduce(((e,t)=>e+(t.weight||1)),0);return e=n,t=r,r}})(),A=e=>{if(!e)throw new Error("Canvas is not available.");const t=e.getContext("2d");if(!t)throw new Error("Could not obtain 2D context from canvas.");return{canvas:e,context:t}},v=({context:e,geometry:t,pie:n,segmentStartAngle:r,anglePerSegment:o,style:l})=>{const{labelX:i,labelY:s,labelAngle:a}=(({geometry:e,segmentStartAngle:t,anglePerSegment:n,labelOffset:r})=>{const o=S(t),l=S(t+n),i=e.radius*r,s=o+(l-o)/2;return{labelX:e.center.x+i*Math.cos(s),labelY:e.center.y+i*Math.sin(s),labelAngle:s}})({geometry:t,segmentStartAngle:r,anglePerSegment:o,labelOffset:l.label.offset});e.save(),e.translate(i,s),e.rotate(a),e.textAlign=l.label.align,e.textBaseline=l.label.baseline,e.fillStyle=n.color,e.font=l.label.font,e.fillText(n.name,0,0),e.restore()},P=({context:e,geometry:t,pie:n,segmentStartAngle:r,anglePerSegment:o,style:l})=>{const i=S(r),s=S(r+o);e.beginPath(),e.moveTo(t.center.x,t.center.y),e.fillStyle=n.bg,e.arc(t.center.x,t.center.y,t.radius,i,s,!0),e.fill(),!1!==l?.pie?.border&&null!=l?.pie?.borderWidth&&null!=l?.pie?.borderColor&&(e.beginPath(),e.strokeStyle=l.pie.borderColor,e.lineWidth=l.pie.borderWidth,e.moveTo(t.center.x,t.center.y),e.lineTo(t.center.x+t.radius*Math.cos(i),t.center.y+t.radius*Math.sin(i)),e.moveTo(t.center.x,t.center.y),e.lineTo(t.center.x+t.radius*Math.cos(s),t.center.y+t.radius*Math.sin(s)),e.stroke())},M=({rouletteItemList:e,mergedOptions:t,context:n,geometry:r,rouletteRef:o})=>{n.beginPath(),n.fillStyle=t.style.canvas.bg,n.fillRect(0,0,2*r.radius,2*r.radius),(({initialAngleOffset:e,context:t,startAngle:n,geometry:r,pieList:o,style:l})=>{const i=360/w(o);let s=e%360+n;const a=o.map(((e,t)=>{const n=e.bg||l.pie.theme[t%l.pie.theme.length].bg,r=e.color||l.pie.theme[t%l.pie.theme.length].color||l.label.defaultColor,o=e.weight||1,s=i*o;return{name:e.name,bg:n,color:r,weight:o,anglePerWeight:i,anglePerSegment:s}}));for(const g of a){const e=i*g.weight,n=(s-e+360)%360;P({context:t,geometry:r,pie:g,segmentStartAngle:n,anglePerSegment:e,style:l}),v({context:t,geometry:r,pie:g,segmentStartAngle:n,anglePerSegment:e,style:l}),s=n}if(!1===l?.pie?.border||null==l?.pie?.borderWidth||null==l?.pie?.borderColor)return;const c=l.pie.borderWidth;t.beginPath(),t.strokeStyle=l.pie.borderColor,t.lineWidth=c,t.arc(r.center.x,r.center.y,r.radius-c/2,0,2*Math.PI,!0),t.stroke()})({pieList:e,initialAngleOffset:o.current.totalRotation,startAngle:t.determineAngle,style:t.style,context:n,geometry:r}),t.showArrow&&(({context:e,geometry:t,determineAngle:n,style:r})=>{const o=S(n),l=t.center.x+t.radius*Math.cos(o),i=t.center.y+t.radius*Math.sin(o),s=r.arrow.size,a=l-s*Math.cos(o),c=i-s*Math.sin(o),g=a+s*Math.sin(o),u=c-s*Math.cos(o),m=a-s*Math.sin(o),d=c+s*Math.cos(o);e.beginPath(),e.moveTo(l,i),e.lineTo(g,u),e.lineTo(m,d),e.closePath(),e.fillStyle=r.arrow.bg,e.fill()})({context:n,style:t.style,geometry:r,determineAngle:t.determineAngle})},R=({rouletteItemList:e,mergedOptions:t,context:n,status:r,geometry:o,rouletteRef:l,onFinish:i})=>{let s,a=l.current.speed;const c="clockwise"===t.rotationDirection?(e,t)=>e-t:(e,t)=>e+t;const g=()=>{a=((e,t,n)=>"running"===e&&t<=n.maxSpeed?t+n.acceleration:"ending"===e&&t>=0?t-n.deceleration:t)(r,a,t),l.current.speed=a,l.current.totalRotation=c(l.current.totalRotation,a);if("ending"===r&&a<0){const n=(({rouletteItemList:e,totalRotation:t,rotationDirection:n})=>{const r=Math.abs(t)%360,o=r>360?r-360:r,l=w(e),i="clockwise"===n?[...e].reverse():e;let s=0;for(const a of i){const e=(a.weight||1)/l*360;if(o>=s&&o<s+e)return a.name;s+=e}return"No Result"})({rouletteItemList:e,rotationDirection:t.rotationDirection,totalRotation:l.current.totalRotation});i(n)}else M({rouletteItemList:e,mergedOptions:t,context:n,geometry:o,rouletteRef:l}),s=requestAnimationFrame(g)};return g(),()=>cancelAnimationFrame(s)};var C=n(80184);const k=()=>{const{t:e}=(0,u.$G)(["customers-club","global"]),{enqueueSnackbar:t}=(0,f.Ds)(),{roulette:n,onStart:r,onStop:o,result:l}=((0,m.dp)("Customers-Club.Welcome"),(({items:e,onSpinUp:t,onSpinDown:n,onSpinEnd:r,options:o={}})=>{const l=(0,p.useMemo)((()=>({...x,...o,style:{canvas:{...x.style.canvas,...o.style?.canvas},label:{...x.style.label,...o.style?.label},arrow:{...x.style.arrow,...o.style?.arrow},pie:{...x.style.pie,...o.style?.pie,theme:[...o.style?.pie?.theme||x.style.pie.theme]}}})),[o]),i=(0,p.useRef)(null),s=(0,p.useRef)({speed:0,totalRotation:l.initialAngle}),a=(0,p.useRef)(""),c=(0,p.useMemo)((()=>{const e=l.size/2;return{radius:e,center:{x:e,y:e}}}),[l]),[g,u]=(0,p.useState)("stop"),m=(0,p.useCallback)((()=>{"stop"===g&&u("running")}),[g]),d=(0,p.useCallback)((()=>{"running"===g&&u("ending")}),[g]);return(0,p.useEffect)((()=>{if("stop"!==g)return;const{context:t}=A(i.current);M({rouletteItemList:e,mergedOptions:l,context:t,geometry:c,rouletteRef:s})}),[g,c,e,l]),(0,p.useEffect)((()=>{if("running"!==g&&"ending"!==g)return;"running"===g&&t?.(),"ending"===g&&n?.();const{context:o}=A(i.current),m=R({rouletteItemList:e,mergedOptions:l,context:o,status:g,geometry:c,rouletteRef:s,onFinish:e=>{u("stop"),a.current=e,r?.(e)}});return()=>{m()}}),[g,c,e,l,r,n,t]),{roulette:{size:l.size,canvasRef:i},result:a.current,onStart:m,onStop:d}})({items:[{name:"\u062e\u0631\u06cc\u062f \u062e\u0648\u0646\u0647"},{name:"label2"},{name:"label3"},{name:"label4"},{name:"label5"},{name:"label6"}],options:{style:{label:{font:"inherit"}}}}));return(0,C.jsx)(b.Z,{children:(0,C.jsx)(b.Z,{sx:{mb:2},children:(0,C.jsx)(y,{roulette:n})})})},j=(0,r.ZP)("div")((({theme:e})=>({"& h3":{marginTop:0}}))),T=()=>{const{t:e}=(0,u.$G)("customers-club"),t=(0,m.Vg)("Customers-Club.wheel");return(0,C.jsx)(h.xf,{...t,children:(0,C.jsx)(d.Z,{children:(0,C.jsx)(o.Z,{variant:"outlined",sx:{mb:3},children:(0,C.jsx)(l.Z,{sx:{p:3},children:(0,C.jsxs)(i.ZP,{container:!0,spacing:5,children:[(0,C.jsx)(i.ZP,{item:!0,xs:12,sm:6,children:(0,C.jsx)(s.Z,{color:"info",severity:"info",children:(0,C.jsx)(j,{children:(0,C.jsx)(g.Z,{breaks:!0,children:c().sanitize("\n### \u0646\u06a9\u0627\u062a \u0622\u0645\u0648\u0632\u0634\u06cc\n    ")})})})}),(0,C.jsx)(i.ZP,{item:!0,xs:12,md:6,children:(0,C.jsx)(k,{})})]})})})})})}}}]);
//# sourceMappingURL=7627.efaea720.chunk.js.map
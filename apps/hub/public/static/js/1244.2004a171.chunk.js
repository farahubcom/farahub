(globalThis.webpackChunkfarahub=globalThis.webpackChunkfarahub||[]).push([[1244],{53076:(e,n,t)=>{"use strict";t.d(n,{Z:()=>p});var i=t(81598),l=t(65661),r=t(68870),o=t(13400),s=t(94721),a=t(39157),c=t(97123),d=t(36151),u=t(72791),x=t(26411),h=t(80184);const p=({title:e,defaultValue:n,onSubmit:t,open:p,onClose:m,renderContent:g,dialogProps:j={}})=>{const[v,Z]=(0,u.useState)(n);return(0,u.useEffect)((()=>{p&&Z(n)}),[p]),(0,h.jsxs)(x.Z,{open:p,onClose:m,dialogProps:{fullWidth:!0,maxWidth:"xs",...j},children:[(0,h.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,h.jsx)(r.Z,{children:e}),(0,h.jsx)(o.Z,{onClick:m,size:"small",children:(0,h.jsx)(i.Z,{})})]}),(0,h.jsx)(s.Z,{}),(0,h.jsx)(a.Z,{children:g&&g({value:v,setValue:Z})}),(0,h.jsx)(s.Z,{}),(0,h.jsxs)(c.Z,{children:[(0,h.jsx)(d.Z,{type:"submit",variant:"contained",onClick:e=>t(v),children:"\u062b\u0628\u062a"}),(0,h.jsx)(r.Z,{sx:{flexGrow:1}}),(0,h.jsx)(d.Z,{type:"button",onClick:m,children:"\u0627\u0646\u0635\u0631\u0627\u0641"})]})]})}},13268:(e,n,t)=>{"use strict";t.d(n,{Z:()=>o});var i=t(31357),l=t.n(i);class r{}r.getItemPureTotal=e=>e.amount*e.unitPrice,r.getItemDiscountPrice=e=>e.discount||0,r.getItemTotalPrice=e=>r.getItemPureTotal(e)-r.getItemDiscountPrice(e),r.getFactorPrice=(e,n)=>("PRICE"===n.unit?n.amount:n.amount/100*r.getInvoiceSubtotal(e))*("REDUCER"===n.type?-1:1),r.getInvoiceSubtotal=e=>l()(e,(e=>r.getItemTotalPrice(e))),r.getInvoiceTotal=(e,n)=>Number(r.getInvoiceSubtotal(e))+l()(n,(n=>r.getFactorPrice(e,n)));const o=r},1244:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>me});var i=t(61889),l=t(35065),r=t(61709),o=t(7175),s=t(72791),a=t(46019),c=t(54163);const d=(0,s.createContext)();var u=t(58518),x=t(27067),h=t(80184);const p=(e,n)=>{var t,i;if(!e||!n||null===(t=e.prices)||void 0===t||!t.length)return 0;const l=e.prices.find((e=>e.pricing._id===n.id));return null!==(i=null===l||void 0===l?void 0:l.amount)&&void 0!==i?i:0};function m({injectedHooks:e={},defaultValues:n={},children:t}){const{inject:i}=(0,a.aC)(),r=(0,l.dp)("Invoices.Main"),o=(e,n)=>({item:e,amount:1,discount:0,unitPrice:p(e,n),...Object.assign({},...i("Invoices","InvoiceForm.newItemValues")||[])}),m={status:"",customer:null,issuedAt:new Date,number:"",pricing:null,note:"",items:[o()],...Object.assign({},...i("Invoices","InvoiceForm.initialValues")||[]),...n},{enqueueSnackbar:g}=(0,u.Ds)(),j=(0,x.Z)(),v=(0,l.Vg)("Invoices.list"),Z=(0,c.Z)({initialValues:m,handlePost:e=>r.createOrUpdate({...e}),onSubmit:()=>{g("\u0641\u0627\u06a9\u062a\u0648\u0631 \u062b\u0628\u062a \u06af\u0631\u062f\u06cc\u062f."),j(v,{replace:!0})}});(0,s.useEffect)((()=>{(async()=>{let e=await r.getDefaultPricing();const t=e.pricing;let i=n.number;n.id||(e=await r.getNewNumber(),i=e.number),Z.reset({...m,number:i,pricing:t})})()}),[]);return(0,h.jsxs)(d.Provider,{value:{...Z,addRow:(e=null)=>{const n=Z.getValue("items"),t=Z.getValue("pricing");if(e){const i=n.findIndex((n=>{var t;return(null===(t=n.item)||void 0===t?void 0:t._id)===e._id}));-1!==i?n[i].amount+=1:n.length>0&&!n[n.length-1].item?n[n.length-1]={...n[n.length-1],item:e,unitPrice:p(e,t)}:n.push(o(e,t))}else n.push(o(null,t));Z.setValue("items",n)},removeRow:e=>{const n=Z.getValue("items"),t=Z.getValue("pricing");Z.setValue("items",0===e&&1===n.length?[o(null,t)]:n.filter(((n,t)=>t!==e)))}},children:[t,i("Invoices","InvoiceForm.Footer",{...Z,...e})]})}const g=()=>(0,s.useContext)(d);var j=t(11228),v=t(4830),Z=t(66934),C=t(20890),f=t(99259),b=t(68870),P=t(27391),I=t(36314),w=t(57621),y=t(9585),V=t(39504),k=t(56125),S=t(36151),F=t(66888),R=t(36571),z=t(67317),W=t(39230),T=t(20139),D=t(53076),_=t(73891),H=t(30101);const A=(0,Z.ZP)(C.Z)((({theme:e})=>({position:"relative",cursor:"pointer",transition:e.transitions.create("padding"),"& .MuiSvgIcon-root":{position:"absolute",right:0,opacity:0,transition:e.transitions.create("opacity")},"&:hover":{paddingInlineEnd:"1.25em"},"&:hover .MuiSvgIcon-root":{opacity:1}})));function M({children:e,...n}){return(0,h.jsxs)(A,{...n,children:[e,(0,h.jsx)(f.Z,{fontSize:"small",sx:{verticalAlign:"middle"},children:(0,h.jsx)(v.JO,{icon:"solar:pen-linear"})})]})}const O=()=>{var e,n;const{t:t}=(0,W.$G)(["global","invoices"]),{getValue:i,setValue:r}=g(),[o,a]=(0,s.useState)(!1),c=(0,l.Co)("People.PersonSelectDialog"),{isOpen:d,close:u,open:x}=(0,_.Z)(!1),p=(0,l.Co)("Pricing.PricingsDialog"),{isOpen:m,close:Z,open:f}=(0,_.Z)(!1),[A,O]=(0,s.useState)({open:!1}),E=[{label:"\u0648\u0636\u0639\u06cc\u062a",value:i("status")},{label:"\u0645\u0634\u062a\u0631\u06cc",value:(null===(e=i("customer"))||void 0===e?void 0:e.fullName)||"\u0645\u0634\u062a\u0631\u06cc \u0645\u062a\u0641\u0631\u0642\u0647",onClick:x},{label:"\u062a\u0627\u0631\u06cc\u062e",renderValue:(0,h.jsx)(H.Z,{defaultValue:i("issuedAt"),onSubmit:e=>r("issuedAt",e),InlineComponent:C.Z,inlineComponentProps:{fontWeight:600,variant:"body1",sx:{display:"flex",justifyContent:"flex-end",width:"100%"}},renderInlineValue:e=>(0,z.Z)(e,"yyyy/MM/dd"),renderForm:({value:e,setValue:n,toFocusRef:t})=>(0,h.jsx)(b.Z,{children:(0,h.jsx)(R._,{dateAdapter:j.Z,children:(0,h.jsx)(F.M,{mask:"____/__/__",onChange:n,value:e,renderInput:e=>(0,h.jsx)(P.Z,{InputLabelProps:{shrink:!0},fullWidth:!0,size:"small",inputRef:t,...e})})})})})},{label:"\u0634\u0645\u0627\u0631\u0647",renderValue:(0,h.jsx)(H.Z,{defaultValue:i("number"),onSubmit:e=>r("number",e),InlineComponent:C.Z,inlineComponentProps:{fontWeight:600,variant:"body1",sx:{display:"flex",justifyContent:"flex-end",width:"100%"}},renderForm:({value:e,setValue:n,toFocusRef:t})=>(0,h.jsx)(T.Z,{fullWidth:!0,size:"small",dir:"ltr",value:e,onChange:e=>n(e.target.value),required:!0,inputProps:{ref:t}})})}],$=[{label:"\u062a\u0639\u0631\u0641\u0647",value:(null===(n=i("pricing"))||void 0===n?void 0:n.name)||"\u062a\u0639\u0631\u0641\u0647 \u067e\u06cc\u0634\u200c\u0641\u0631\u0636",onClick:f},{label:"\u062a\u0648\u0636\u06cc\u062d\u0627\u062a",value:i("note")||(0,h.jsx)(C.Z,{color:"inherit",sx:{opacity:.5},display:"inline",children:"\u0634\u0631\u062d \u062f\u0647\u06cc\u062f..."}),props:{direction:"column",alignItems:"flex-start"},onClick:((e,n={})=>()=>{O({renderContent:e,...n,open:!0})})((({value:e,setValue:n})=>(0,h.jsx)(P.Z,{InputLabelProps:{shrink:!0},fullWidth:!0,multiline:!0,rows:3,label:"\u062a\u0648\u0636\u06cc\u062d\u0627\u062a \u0641\u0627\u06a9\u062a\u0648\u0631",value:e,onChange:e=>n(e.target.value),autoFocus:!0})),{title:"\u062a\u0648\u0636\u06cc\u062d\u0627\u062a \u0641\u0627\u06a9\u062a\u0648\u0631",defaultValue:i("note"),onSubmit:e=>{r("note",e),O({open:!1})}})}],q=e=>(0,h.jsx)(I.Z,{children:e.map(((e,n)=>{var t;return(0,h.jsxs)(I.Z,{direction:"row",alignItems:"center",sx:{mb:2},...null!==(t=e.props)&&void 0!==t?t:{},children:[(0,h.jsx)(C.Z,{variant:"body1",sx:{flexGrow:1},children:e.label}),(0,h.jsx)(b.Z,{display:"inline-flex",justifyContent:"flex-end",alignItems:"center",flexGrow:"1",children:e.renderValue||(0,h.jsx)(M,{sx:{marginInlineStart:"auto"},onClick:e.onClick,fontWeight:600,variant:"body1",children:e.value})})]},n)}))});return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(w.Z,{variant:"outlined",children:[(0,h.jsx)(y.Z,{title:"\u0639\u0645\u0648\u0645\u06cc",titleTypographyProps:{variant:"subtitle2"}}),(0,h.jsxs)(V.Z,{children:[q(E),(0,h.jsx)(k.Z,{in:o,children:q($)}),(0,h.jsx)(S.Z,{endIcon:(0,h.jsx)(v.JO,{icon:"solar:alt-arrow-down-bold"}),sx:{marginInlineStart:"auto"},onClick:()=>a(!o),children:t("\u0645\u0634\u062e\u0635\u0627\u062a \u0628\u06cc\u0634\u062a\u0631")})]})]}),(0,h.jsx)(c,{open:d,onClose:u,selected:i("customer"),roles:["customer"],onSelect:e=>{r("customer",e),u()},onClear:()=>{r("customer",""),u()}}),(0,h.jsx)(p,{selectable:!0,open:m,onClose:Z,selected:i("pricing"),onChange:e=>{r("pricing",e),Z()},onClear:()=>{r("pricing",""),Z()}}),(0,h.jsx)(D.Z,{...A,onClose:()=>O({open:!1})})]})};var E=t(42419),$=t(35585),q=t(56890),G=t(13400),J=t(63466),N=t(39281),L=t(79836),U=t(35855),B=t(68745),K=t(53382),Q=t(97639),X=t(94721),Y=t(72363),ee=t(25506),ne=t.n(ee),te=t(70109),ie=t.n(te),le=t(64286),re=t.n(le),oe=t(25863),se=t(13268),ae=t(14381);const ce=(0,Z.ZP)(q.Z)((({theme:e})=>({"& .MuiTableCell-root":{backgroundColor:e.palette.background.paper}})));function de({injectedHooks:e={}}){const{inject:n}=(0,a.aC)(),{t:t}=(0,W.$G)(["global","invoices"]),{getValue:i,setValue:r,addRow:o,removeRow:c,...d}=g(),u=(0,s.useMemo)((()=>se.Z.getInvoiceSubtotal(i("items"))),[i("items")]),x=(0,l.Co)("Products.ProductSelectDialog"),[p,m]=(0,s.useState)({open:!1}),j=re()([{title:"#",headerCellProps:{align:"center"},rowCellProps:{align:"center",width:75},renderCell:(e,n)=>(0,h.jsx)(C.Z,{fontSize:"1.25rem",fontWeight:900,children:n+1}),priority:100},{title:t("\u06a9\u0627\u0644\u0627/\u062e\u062f\u0645\u062a"),headerCellProps:{align:"center"},rowCellProps:(e,n)=>({align:"center",width:200,onClick:()=>m({open:!0,rowIndex:n,selected:e.item}),sx:{cursor:"pointer"}}),renderCell:(e,n)=>{var i;return(null===(i=e.item)||void 0===i?void 0:i.name)||t("\u0627\u0646\u062a\u062e\u0627\u0628 \u06a9\u0646\u06cc\u062f...")},priority:200},{title:t("\u0645\u0642\u062f\u0627\u0631"),headerCellProps:{align:"center"},rowCellProps:{align:"center",width:175},renderCell:(e,n)=>(0,h.jsxs)(b.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,h.jsx)(G.Z,{size:"small",onClick:()=>{var t;return r(`items[${n}].amount`,(null!==(t=e.amount)&&void 0!==t?t:1)-1)},disabled:e.amount<2,children:(0,h.jsx)($.Z,{fontSize:"inherit"})}),(0,h.jsx)(C.Z,{sx:{mx:1,verticalAlign:"middle"},children:e.amount}),(0,h.jsx)(G.Z,{size:"small",onClick:()=>{var t;return r(`items[${n}].amount`,(null!==(t=e.amount)&&void 0!==t?t:1)+1)},children:(0,h.jsx)(E.Z,{fontSize:"inherit"})})]}),priority:300},{title:(0,h.jsxs)(h.Fragment,{children:[t("\u0642\u06cc\u0645\u062a \u0648\u0627\u062d\u062f")," ",(0,h.jsx)(C.Z,{variant:"caption",children:"(\u0631\u06cc\u0627\u0644)"})]}),headerCellProps:{align:"center",width:175},rowCellComponent:H.Z,rowCellProps:(e,n)=>({align:"center",width:175,defaultValue:e.unitPrice,onSubmit:e=>r(`items[${n}].unitPrice`,e),InlineComponent:ae.Z,renderInlineValue:oe.Z,inlineComponentProps:{align:"center"},renderForm:({value:e,setValue:n,toFocusRef:t})=>(0,h.jsx)(ae.Z,{align:"center",children:(0,h.jsx)(T.Z,{fullWidth:!0,size:"small",dir:"ltr",InputProps:{inputRef:t,startAdornment:(0,h.jsx)(J.Z,{position:"start",children:(0,h.jsx)("small",{children:"\u0631\u06cc\u0627\u0644"})})},value:e,onChange:e=>n(e.target.value),required:!0})})}),renderCell:(e,n)=>null,priority:400},{title:(0,h.jsxs)(h.Fragment,{children:[t("\u062a\u062e\u0641\u06cc\u0641")," ",(0,h.jsx)(C.Z,{variant:"caption",children:"(\u0631\u06cc\u0627\u0644)"})]}),headerCellProps:{align:"center",width:175},rowCellComponent:H.Z,rowCellProps:(e,n)=>({align:"center",width:175,defaultValue:e.discount,onSubmit:e=>r(`items[${n}].discount`,e),InlineComponent:ae.Z,renderInlineValue:oe.Z,inlineComponentProps:{align:"center"},renderForm:({value:e,setValue:n,toFocusRef:t})=>(0,h.jsx)(ae.Z,{align:"center",children:(0,h.jsx)(T.Z,{fullWidth:!0,size:"small",dir:"ltr",InputProps:{inputRef:t,startAdornment:(0,h.jsx)(J.Z,{position:"start",children:(0,h.jsx)("small",{children:"\u0631\u06cc\u0627\u0644"})})},value:e,onChange:e=>n(e.target.value),required:!0})})}),renderCell:(e,n)=>null,priority:500},{title:(0,h.jsxs)(h.Fragment,{children:[t("\u0645\u0628\u0644\u063a \u062e\u0627\u0644\u0635")," ",(0,h.jsx)(C.Z,{variant:"caption",children:"(\u0631\u06cc\u0627\u0644)"})]}),headerCellProps:{align:"center"},rowCellProps:{align:"center",width:175},renderCell:(e,n)=>{const t=se.Z.getItemTotalPrice(e);return ie()(t)?(0,oe.Z)(t):0},priority:600},...ne()(n("Invoices","InvoiceForm.tableDefinitions",{getValue:i,setValue:r,addRow:o,removeRow:c,...d,...e})||[])],(e=>e.priority));return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(w.Z,{variant:"outlined",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,h.jsx)(y.Z,{title:"\u0627\u0642\u0644\u0627\u0645 \u0641\u0627\u06a9\u062a\u0648\u0631",action:(0,h.jsx)(S.Z,{size:"small",variant:"contained",startIcon:(0,h.jsx)(v.JO,{icon:"solar:add-circle-linear"}),onClick:()=>o(),children:"\u0631\u062f\u06cc\u0641 \u062c\u062f\u06cc\u062f"}),titleTypographyProps:{variant:"subtitle2"}}),(0,h.jsx)(V.Z,{sx:{p:0},children:(0,h.jsx)(N.Z,{sx:{maxHeight:"400px",overflow:"auto"},children:(0,h.jsxs)(L.Z,{size:"small",stickyHeader:!0,children:[(0,h.jsx)(ce,{children:(0,h.jsxs)(U.Z,{children:[j.map(((e,n)=>e.render||e.renderCell||e.field?(0,h.jsx)(B.Z,{...e.headerCellProps,sx:{whiteSpace:"nowrap"},children:e.title},n):null)),(0,h.jsx)(B.Z,{})]})}),(0,h.jsx)(K.Z,{children:i("items").map(((e,n)=>(0,h.jsxs)(U.Z,{children:[j.map(((t,i)=>{if(!t.render&&!t.renderCell&&!t.field)return null;const l=t.rowCellComponent||ae.Z;return(0,h.jsx)(l,{..."function"==typeof t.rowCellProps?t.rowCellProps(e,n):t.rowCellProps,children:t.renderCell?t.renderCell(e,n):t.render?t.render(e,n):e[t.field]},i)})),(0,h.jsx)(ae.Z,{align:"center",children:(0,h.jsx)(I.Z,{direction:"row",alignItems:"center",spacing:1,children:(0,h.jsx)(Q.Z,{title:"\u062d\u0630\u0641 \u0633\u0637\u0631",enterDelay:2e3,children:(0,h.jsx)(G.Z,{size:"small",onClick:()=>c(n),children:(0,h.jsx)(v.JO,{icon:"solar:trash-bin-2-broken"})})})})})]},n)))})]})})}),(0,h.jsx)(X.Z,{sx:{mt:"auto"}}),(0,h.jsx)(Y.Z,{sx:{justifyContent:"flex-end"},children:(0,h.jsxs)(C.Z,{variant:"subtitle2",children:["\u0645\u062c\u0645\u0648\u0639: ",ie()(u)?(0,oe.Z)(u):0," ",(0,h.jsx)(C.Z,{variant:"caption",children:"\u0631\u06cc\u0627\u0644"})]})})]}),(0,h.jsx)(x,{...p,onSelect:o,onClose:()=>m({open:!1})})]})}function ue({injectedHooks:e}){const{inject:n}=(0,a.aC)(),{register:t,handleSubmit:i,loading:l,reset:r,getValue:o,setValue:s}=g();return(0,h.jsxs)(w.Z,{variant:"outlined",children:[(0,h.jsx)(y.Z,{title:"\u067e\u0631\u062f\u0627\u062e\u062a",titleTypographyProps:{variant:"subtitle2"}}),(0,h.jsx)(V.Z,{children:n("Invoices","InvoiceForm.Payment",{register:t,loading:l,getValue:o,setValue:s,reset:r,...e})}),(0,h.jsx)(Y.Z,{children:(0,h.jsx)(S.Z,{variant:"contained",size:"large",fullWidth:!0,onClick:i,children:"\u0627\u06cc\u062c\u0627\u062f \u0641\u0627\u06a9\u062a\u0648\u0631"})})]})}var xe=t(20952),he=t(45109);function pe(){var e,n;const t=(0,xe.Z)("Invoices.Main"),{data:i,loading:l,reload:r}=(0,he.Z)({handler:()=>t.quickAccess()}),{addRow:o}=g();return(0,h.jsxs)(w.Z,{variant:"outlined",children:[(0,h.jsx)(y.Z,{title:"\u062f\u0633\u062a\u0631\u0633\u06cc \u0633\u0631\u06cc\u0639",titleTypographyProps:{variant:"subtitle2"}}),(0,h.jsxs)(V.Z,{children:[(null===(e=i.data)||void 0===e?void 0:e.length)<1&&(0,h.jsx)(C.Z,{textAlign:"center",children:"\u0645\u0648\u0631\u062f\u06cc \u0648\u062c\u0648\u062f \u0646\u062f\u0627\u0631\u062f"}),(null===(n=i.data)||void 0===n?void 0:n.length)>0&&(0,h.jsx)(I.Z,{direction:"row",flexWrap:"wrap",gap:1,children:i.data.map(((e,n)=>(0,h.jsx)(S.Z,{variant:"outlined",color:"inherit",onClick:()=>o(e),children:e.name},n)))})]})]})}const me=()=>{const{inject:e}=(0,a.aC)(),n=(0,l.Vg)("Invoices.create"),t=Object.assign({},...e("Invoices","InvoiceForm.Hooks")||[]);return(0,h.jsx)(m,{injectedHooks:t,children:(0,h.jsx)(o.xf,{...n,children:(0,h.jsx)(r.Z,{maxWidth:"xl",fullHeight:!0,children:(0,h.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,h.jsx)(i.ZP,{item:!0,xs:3,children:(0,h.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,h.jsx)(i.ZP,{item:!0,xs:12,children:(0,h.jsx)(O,{})}),(0,h.jsx)(i.ZP,{item:!0,xs:12,children:(0,h.jsx)(pe,{})})]})}),(0,h.jsxs)(i.ZP,{item:!0,xs:9,container:!0,justifyContent:"end",spacing:2,children:[(0,h.jsx)(i.ZP,{item:!0,xs:12,children:(0,h.jsx)(de,{injectedHooks:t})}),(0,h.jsx)(i.ZP,{item:!0,xs:4,children:(0,h.jsx)(ue,{injectedHooks:t})})]})]})})})})}},35585:(e,n,t)=>{"use strict";var i=t(64836);n.Z=void 0;var l=i(t(45649)),r=t(80184),o=(0,l.default)((0,r.jsx)("path",{d:"M19 13H5v-2h14v2z"}),"Remove");n.Z=o},58645:e=>{e.exports=function(e,n){for(var t,i=-1,l=e.length;++i<l;){var r=n(e[i]);void 0!==r&&(t=void 0===t?r:t+r)}return t}},70109:(e,n,t)=>{var i=t(97009).isFinite;e.exports=function(e){return"number"==typeof e&&i(e)}},31357:(e,n,t)=>{var i=t(56025),l=t(58645);e.exports=function(e,n){return e&&e.length?l(e,i(n,2)):0}}}]);
//# sourceMappingURL=1244.2004a171.chunk.js.map